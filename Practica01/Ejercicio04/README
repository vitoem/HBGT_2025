
#Algunas plataformas de secuenciaci칩n generan los datos de salida en formato BAM (binary alignment mapping), es por ello que es importante saber manipular este tipo de datos y extraer informaci칩n de secuencias y calidades. Para esto utilizaremos las herramientas de samtools y bedtools.

#Paso 1.-  Convertiremos un archivo en formato BAM a formato SAM

module load samtools/1.10/gcc/8.3.1-jqix

srun --mem 8G -n1 -p q2 samtools view -h -o pacbio.sam --threads 1 pacbio.bam

module purge

#Paso 2.-  A partir del archivo en formato BAM extraeremos la infromaci칩n referente a las secuencias y calidades en formato fastq.

module load bedtools2/2.27.1/gcc/8.3.1-7tc5

srun --mem 8G -n1 -p q2 bamToFastq -i pacbio.bam -fq pacbio.fastq

module purge

#Finalmente consultaremos el tama츮 de las lecturas del archivo fastq con a ayuda de bioawk.

module load bioawk/1.0/gcc/8.3.1-moy3

srun --mem 8G -n1 -p q2 bioawk -c fastx '{ print $name, length($seq) }' pacbio.fastq > pacbio_length.tsv

# Podemos consultar el rango de tama침os con ayuda de los comandos head y tail
srun --mem 8G -n1 -p q2 sort -k2,2 -n pacbio_length.tsv | head -n 1
srun --mem 8G -n1 -p q2 sort -k2,2 -n pacbio_length.tsv | tail -n 1

# Tambi츭 es posible determinar el tama츮 promedio de las lecturas con awk
srun --mem 8G -n1 -p q2 awk '{sum = sum + $2} END {print sum/NR}' pacbio_length.tsv

